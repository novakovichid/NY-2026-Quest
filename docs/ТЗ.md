# Техническое задание: фронтовый сайт-квест (GitHub Pages)

## 1. Цель

Создать фронтенд-only сайт-квест, предназначенный для размещения на GitHub Pages. Пользователь проходит квест по строгому сценарию: каждый следующий этап доступен только после успешного прохождения предыдущего. Прогресс сохраняется в `localStorage`, доступен возврат к пройденным этапам. В финале отображается текст финальной загадки и ключ.

---

## 2. Платформа и ограничения

### 2.1. Хостинг и рантайм

* Только статические файлы: `HTML/CSS/JS` + `JSON`.
* Никаких серверных компонентов.
* Все пути должны работать на GitHub Pages (учёт base path репозитория).

### 2.2. Дизайн и viewport

* Mobile-first.
* Целевая модель: iPhone 15 Pro Max.
* Требование: **весь контент текущего шага помещается в один viewport без вертикальной прокрутки**, с запасом под динамическую адресную строку браузера (в т.ч. Яндекс.Браузер).
* Использовать `100svh`/`100dvh` и safe area:

  * `min-height: 100svh;`
  * `@supports (height: 100dvh) { min-height: 100dvh; }`
  * `padding-bottom: env(safe-area-inset-bottom);`
  * `padding-top: env(safe-area-inset-top);`

### 2.3. Визуальный стиль

* Новогодняя палитра.
* Допустимы новогодние паттерны (фон/узоры/снег), без перегруза интерфейса.
* UX приоритетнее декоративных элементов.

---

## 3. Основная механика

### 3.1. Сценарий и доступность шагов

* Квест состоит из последовательных шагов (экраны/вопросы).
* Переход на следующий шаг **только** после верного ответа на текущий.
* Возврат на пройденные шаги разрешён.
* Непройденные будущие шаги должны быть недоступны (не открываются напрямую).

### 3.2. Прогресс и сохранение

* Прогресс хранится в `localStorage`.
* После перезагрузки страницы пользователь попадает на последний доступный шаг (или последний просмотренный в рамках доступных).

### 3.3. Сброс прогресса

* Кнопка сброса прогресса: маленькая иконка “стрелка-кружок”.
* При нажатии:

  * очищается прогресс в `localStorage`,
  * сбрасывается счётчик ошибок,
  * отображается первый шаг квеста.

---

## 4. Кусочки кода (code pieces)

### 4.1. Логика появления

* Для некоторых вопросов предусмотрен “кусочек финального кода” (символ).
* Символ появляется **только после правильного ответа**.
* До правильного ответа:

  * нельзя перейти дальше,
  * нельзя увидеть символ.

### 4.2. Визуальная подача

* Символ отображается рядом с кнопкой перехода (“Далее”) или под ней.
* Символ должен быть **заметным, но не акцентированным**:

  * обычный вес шрифта,
  * без ярких рамок/подсветок,
  * без поясняющих текстов (“вот тебе символ” запрещено).

### 4.3. Источник данных

* Символы хранятся в отдельном JSON-файле (`codes.json`) и подтягиваются из него.
* Вопросы/шаги хранятся в отдельном JSON-файле (`stages.json`) и подтягиваются из него.
* Изменение порядка/содержания шагов и символов должно быть возможно на уровне файлов без правок кода.

---

## 5. Счётчик неверных ответов

* Сквозной элемент интерфейса.
* Расположить “в сторонке” (например, в верхнем правом углу).
* Отображается **только если значение > 0**.
* Увеличивается на 1 при каждой неверной проверке ответа.
* Дополнительно: нажатие на “заблокированный” чекбокс считается ошибочным действием и увеличивает счётчик на 1.

---

## 6. Типы вопросов и правила валидации

### 6.1. Общие правила

* До успешной валидации текущего вопроса кнопка “Далее” недоступна.
* После успешной валидации:

  * вопрос помечается пройденным,
  * становится доступен следующий вопрос,
  * отображается соответствующий кусочек кода (если предусмотрен).

### 6.2. Textbox (текст)

* Сравнение регистронезависимое.
* Нормализация:

  * `trim` пробелов по краям,
  * множественные пробелы внутри → один пробел,
  * приведение к lower case.

### 6.3. Date

* Сравнение по значению даты.
* Внутренний формат хранения: ISO `YYYY-MM-DD`.

### 6.4. Radio

* Верный ответ определяется по выбранному варианту.

### 6.5. Checkbox

* Возможны правила:

  * “выбраны все варианты”,
  * “выбран хотя бы один вариант из разрешённых”.
* Поддержка “заблокированных” вариантов (см. раздел 7).

---

## 7. Заблокированные варианты (checkbox)

Для некоторых вопросов часть чекбоксов помечена как “заблокировано”.

Поведение при нажатии на заблокированный вариант:

* пользователь может нажать на вариант;
* после клика:

  * вариант визуально краснеет,
  * проигрывает анимацию shake,
  * автоматически снимается (становится `not checked`),
  * затем возвращается в нормальное состояние.
* такое действие увеличивает счётчик неверных ответов на 1.

---

## 8. UI/UX и навигация

### 8.1. Структура экрана

Экран каждого шага должен помещаться в один viewport. Рекомендуемая структура:

* Header:

  * название этапа/раздела,
  * справа: счётчик ошибок (если >0) и кнопка сброса прогресса.
* Main:

  * текст вопроса,
  * блок вариантов/инпут,
  * однострочная зона ошибки (чтобы не ломать высоту).
* Footer:

  * кнопка “Назад” (если доступен предыдущий пройденный шаг),
  * кнопка “Проверить”/“Далее”,
  * область вывода кусочка кода (после успеха).

### 8.2. Состояния кнопок

* Пока ответ не проверен или неверен: доступна “Проверить”, “Далее” недоступна.
* После верного ответа:

  * “Проверить” заменяется на “Далее”,
  * появляется кусочек кода (если есть).

### 8.3. Анимации

* Переходы между шагами: slide-анимация (200–350 мс).
* Ошибка: shake + красная обводка на элементе ввода/блоке ответа (200–400 мс).
* Появление символа: fade-in (200–300 мс).

### 8.4. Доступность

* Кликабельная зона элементов ≥ 44px по высоте.
* `label` связан с `input`.
* Радио/чекбоксы кликабельны по всей строке.
* Видимые фокус-стили.

---

## 9. Архитектура приложения

### 9.1. Общий подход

* SPA без сервера.
* Данные грузятся через `fetch` из `/data/stages.json` и `/data/codes.json`.
* Управление состоянием на клиенте.

### 9.2. Модули

1. DataLoader

* загрузка `stages.json` и `codes.json`;
* базовая проверка схемы (наличие id, type, options при необходимости).

2. ProgressStore

* хранение состояния прохождения;
* чтение/запись в `localStorage`.

3. Validator

* проверка ответов по типам (date/text/radio/checkbox);
* нормализация строк для textbox.

4. Renderer/UI

* рендер текущего шага;
* управление состояниями кнопок;
* анимации переходов и ошибок.

### 9.3. Модель прогресса

* Все шаги разворачиваются в плоский список в порядке следования.
* Хранить:

  * `maxUnlockedIndex` — максимальный доступный индекс шага,
  * `completedStepIds` — набор пройденных шагов,
  * `wrongCount` — число ошибок,
  * `codePiecesShown` — набор показанных символов по `stepId`,
  * `lastIndex` — последний открытый шаг (в пределах доступных).

Разрешение на открытие шага:

* шаг доступен, если `index <= maxUnlockedIndex`.

При успешной проверке:

* шаг помечается пройденным,
* `maxUnlockedIndex = max(maxUnlockedIndex, currentIndex + 1)`.

---

## 10. Форматы данных

### 10.1. `data/stages.json`

Требования:

* Должен описывать этапы и их шаги.
* Каждый шаг имеет уникальный `id`.
* Поля:

  * `type`: `date | text | radio | checkbox | final`
  * `prompt` для вопроса или `content` для финала
  * `options` для radio/checkbox
  * `rules` для валидации
  * `blockedOptionIds` для checkbox с блокировками

#### Пример `stages.json`

```json
{
  "meta": { "title": "Новогодний квест", "version": 1 },
  "stages": [
    {
      "id": "stage-1",
      "title": "Введите пароль",
      "steps": [
        {
          "id": "s1-q1",
          "type": "date",
          "prompt": "Введи дату рождения дочери",
          "rules": { "equals": "2025-07-27" }
        }
      ]
    },
    {
      "id": "stage-2",
      "title": "Вопросы",
      "steps": [
        {
          "id": "s2-q1",
          "type": "text",
          "prompt": "Самое ласковое прозвище для мужа",
          "rules": {
            "equalsText": "бегемотик",
            "caseInsensitive": true,
            "trim": true,
            "collapseSpaces": true
          }
        },
        {
          "id": "s2-q2",
          "type": "text",
          "prompt": "Напиши латинское название берёзы повислой",
          "rules": {
            "equalsText": "betula pendula",
            "caseInsensitive": true,
            "trim": true,
            "collapseSpaces": true
          }
        },
        {
          "id": "s2-q3",
          "type": "radio",
          "prompt": "Брут спросил своего родственника: «Фнсоянс счлщлгоя рюш хипгхлъифнш тгунсе Glvqhb фцьифхецих е плуи?». Ответь на вопрос Брута.",
          "options": [
            { "id": "3", "label": "3" },
            { "id": "6", "label": "6" },
            { "id": "9", "label": "9" },
            { "id": "12", "label": "12" },
            { "id": "15", "label": "15" }
          ],
          "rules": { "equalsOptionId": "12" }
        },
        {
          "id": "s2-q4",
          "type": "radio",
          "prompt": "Какой из сериалов лишний?",
          "options": [
            { "id": "odd-1", "label": "Очень Странные Дела" },
            { "id": "odd-2", "label": "Фоллаут" },
            { "id": "odd-3", "label": "Пацаны" },
            { "id": "odd-4", "label": "Папины дочки" },
            { "id": "odd-5", "label": "Начало" },
            { "id": "odd-6", "label": "Бумажный дом" }
          ],
          "rules": { "equalsOptionLabel": "Пацаны" }
        },
        {
          "id": "s2-q5",
          "type": "checkbox",
          "prompt": "Какой у тебя муж?",
          "options": [
            { "id": "kind", "label": "Добрый" },
            { "id": "caring", "label": "Заботливый" },
            { "id": "harmful", "label": "Вредный" },
            { "id": "loved", "label": "Любимый" },
            { "id": "stinky", "label": "Вонючий" },
            { "id": "mad", "label": "Бешеный" },
            { "id": "funny", "label": "Смешной" },
            { "id": "lazy", "label": "Ленивый" },
            { "id": "best", "label": "Самый лучший" },
            { "id": "annoying", "label": "Бесящий" },
            { "id": "fat", "label": "Толстый" }
          ],
          "rules": { "atLeastOneOfAllowed": true },
          "blockedOptionIds": ["harmful", "stinky", "mad", "lazy", "annoying"]
        },
        {
          "id": "s2-q6",
          "type": "checkbox",
          "prompt": "Чего больше всего хочет молодая мама?",
          "options": [
            { "id": "eat", "label": "Есть" },
            { "id": "sleep", "label": "Спать" },
            { "id": "rest", "label": "Отдыхать" }
          ],
          "rules": { "mustSelectAll": true }
        }
      ]
    },
    {
      "id": "stage-3",
      "title": "Финальная загадка",
      "steps": [
        {
          "id": "s3-final",
          "type": "final",
          "content": [
            "Отлично! Ты близко к цели.",
            "Ключ к последней загадке: 435126",
            "А шифр ты уже знаешь."
          ]
        }
      ]
    }
  ]
}
```

### 10.2. `data/codes.json`

Требования:

* Маппинг `stepId → codePiece`.
* Поля `final.key` и `final.cipherText` зарезервированы.

#### Пример `codes.json`

```json
{
  "meta": { "version": 1 },
  "pieces": {
    "s2-q1": "А",
    "s2-q2": "Н",
    "s2-q3": "К",
    "s2-q4": "О",
    "s2-q5": "С",
    "s2-q6": "А"
  },
  "final": {
    "key": "435126",
    "cipherText": ""
  }
}
```

---

## 11. Контент квеста (логика и ответы)

### 11.1. Шаги и ответы

1. `s1-q1` (date)

* Вопрос: “Введи дату рождения дочери”
* Ответ: `2025-07-27`

2. `s2-q1` (text)

* Вопрос: “Самое ласковое прозвище для мужа”
* Ответ: `бегемотик`
* Символ: `А`

3. `s2-q2` (text)

* Вопрос: “Напиши латинское название берёзы повислой”
* Ответ: `betula pendula`
* Символ: `Н`

4. `s2-q3` (radio)

* Вопрос: шифротекст
* Ответ: `12`
* Символ: `К`

5. `s2-q4` (radio)

* Вопрос: “Какой из сериалов лишний?”
* Ответ: “Пацаны”
* Символ: `О`

6. `s2-q5` (checkbox)

* Вопрос: “Какой у тебя муж?”
* Правило: выбран хотя бы один незаблокированный вариант
* Заблокированы: “Вредный”, “Вонючий”, “Бешеный”, “Ленивый”, “Бесящий”
* Символ: `С`

7. `s2-q6` (checkbox)

* Вопрос: “Чего больше всего хочет молодая мама?”
* Правило: выбраны все варианты
* Символ: `А`

8. `s3-final` (final)

* Контент:

  * “Отлично! Ты близко к цели.”
  * “Ключ к последней загадке: 435126”
  * “А шифр ты уже знаешь.”

---

## 12. Критерии приёмки

1. Невозможно перейти к следующему шагу без правильного ответа на текущий.
2. Возможен возврат к любому пройденному шагу.
3. Прогресс корректно восстанавливается после перезагрузки страницы.
4. Кнопка сброса прогресса очищает `localStorage`, сбрасывает ошибки, возвращает на первый шаг.
5. Кусочки кода не видны до правильного ответа, появляются после правильного, подтягиваются из `codes.json`.
6. Счётчик ошибок скрыт при 0 и отображается при >0 на всех шагах.
7. Заблокированные чекбоксы: при клике краснеют, трясутся, снимаются, увеличивают счётчик ошибок.
8. На iPhone 15 Pro Max (портрет) нет вертикальной прокрутки, контент не попадает под системные области (safe area, адресная строка).
9. Проект полностью работает на GitHub Pages с корректными путями к JSON и ассетам.
